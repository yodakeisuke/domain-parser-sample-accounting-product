# AggregateDesignCanvas から Kotlin コード生成のためのガイドライン作成計画

## 背景と目的
イベントストーミングからコードへの変換プロセスにおいて、中間成果物であるAggregateDesignCanvasからKotlinコードへの変換ガイドラインを提供することを目的としています。このガイドラインは、ドメイン駆動設計（DDD）の文脈における集約（Aggregate）の実装パターンを提供します。

## 要件
- AggregateDesignCanvas（マークダウン+mermaidフォーマット）を入力とする
- 完全なコードではなく、集約の「枠組み」を生成することが目標
- 集約の「枠組み」とは：
  - イベントのユニオンタイプとしての集約
  - 各イベント（≒状態）に対応するコマンドメソッドの定義
  - コマンド実行による状態遷移と新しいイベント生成のメカニズム

## 設計方針
1. **集約のモデル化**
   - シールドクラス階層を使用して集約をイベントのユニオンタイプとして表現
   - シールドインターフェース（または抽象クラス）をトップレベルの型として定義
   - 各状態を表すクラスを実装クラスとして定義

2. **コマンドの実装**
   - 各状態クラスに適用可能なコマンドをメソッドとして実装
   - 状態遷移を表現するメソッドの戻り値として新しい状態を返す
   - 不正な状態遷移に対するバリデーションを実装

3. **イベントの生成**
   - コマンド実行の結果としてイベントオブジェクトを生成
   - イベントクラス階層を別途定義
   - イベントには状態変化に必要な情報を保持

## 作業ステップ
1. AggregateDesignCanvasの構造分析
   - 各セクションから抽出すべき情報の特定
   - マークダウンパース方法の検討

2. Kotlin実装パターンの設計
   - シールドクラス/インターフェース階層の設計
   - コマンドメソッドの設計方針
   - イベントクラスの設計方針

3. 変換ガイドラインの作成
   - AggregateDesignCanvasの各セクションからコードへの変換ルール
   - 状態遷移図からKotlinコードへの変換例
   - 不変条件のコードでの表現方法

4. サンプルコード生成例の作成
   - サンプルAggregateDesignCanvasからの具体的な変換例
   - 各セクションがどのようにコードに反映されるかの例示

5. Cursor Project Ruleとしての文書化
   - ルール文書のフォーマット設計
   - サンプルと説明の整理

## タイムライン
- 日1: 設計方針の確定とADCの構造分析
- 日2: Kotlin実装パターンの設計と変換ガイドラインのドラフト作成
- 日3: サンプルコード生成例の作成とレビュー
- 日4: Cursor Project Ruleとしての文書化と最終調整

## 成果物
- AggregateDesignCanvasからKotlinコードへの変換ガイドライン（Cursor Project Rule）
- サンプル変換例
- 実装パターンの解説

## 要件のまとめ
AggregateDesignCanvasは、集約の名前、説明、状態遷移、不変条件、コマンドとイベントの対応関係などを記述したものです。これを元に、Kotlinでの集約実装の「枠組み」を生成します。集約は状態（イベント）のユニオンタイプとして表現され、各状態に対応するコマンドメソッドを持ちます。コマンド実行により状態が遷移し、その結果として新たなイベントが生成されます。この変換プロセスをガイドラインとして整理し、イベントストーミングからコードへの橋渡しを容易にすることが目標です。 